<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>7 Parser</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/mn.html)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/mn.html)"> 
<!-- html,2 --> 
<meta name="src" content="tpg.tex"> 
<meta name="date" content="2005-03-01 21:58:00"> 
<link rel="stylesheet" type="text/css" href="tpg.css"> 
</head><body 
>
   <!--l. 105--><div class="crosslinks"><p class="noindent">[<a 
href="tpgch8.html" >next</a>] [<a 
href="tpgch6.html" >prev</a>] [<a 
href="tpgch6.html#tailtpgch6.html" >prev-tail</a>] [<a 
href="#tailtpgch7.html">tail</a>] [<a 
href="tpgpa2.html#tpgch7.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;7</span><br><a 
 id="x20-470007"></a>Parser</h2>
   <h3 class="sectionHead"><span class="titlemark">7.1   </span> <a 
 id="x20-480007.1"></a>Declaration</h3>
<!--l. 3--><p class="noindent">A parser is declared as a <span 
class="cmti-10">tpg.Parser </span>class. The doc string of the class contains the definition of the tokens
and rules.
<!--l. 6--><p class="noindent">
   <h3 class="sectionHead"><span class="titlemark">7.2   </span> <a 
 id="x20-490007.2"></a>Grammar rules</h3>
<!--l. 8--><p class="noindent">Rule declarations have two parts. The left side declares the symbol associated to the rule, its
attributes and its return value. The right side describes the decomposition of the rule. Both
parts of the declaration are separated with an arrow (<span 
class="cmsy-10"><img 
src="cmsy10-21.png" alt="--&gt;" class="10x-x-21" /></span>) and the declaration ends with a
<span 
class="cmti-10">;</span>.
<!--l. 14--><p class="indent">   The symbol defined by the rule as well as the symbols that appear in the rule can have attributes and
return values. The attribute list - if any - is given as an object list enclosed in left and right
angles. The return value - if any - is extracted by the infix <span 
class="cmti-10">/ </span>operator. See figure&#x00A0;<a 
href="#x20-490011">7.1<!--tex4ht:ref: parser:rule --></a> for
example.
<!--l. 19--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-490011"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-19-" ><colgroup id="TBL-19-1g"><col 
id="TBL-19-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-19-1-"><td  style="text-align:left;" id="TBL-19-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.1: </td><td  
class="content">Rule declaration</td></tr></table><!--tex4ht:label?: x20-490011 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;SYMBOL&#x00A0;&lt;att1,&#x00A0;att2,&#x00A0;att3&gt;&#x00A0;/&#x00A0;return_expression_of_SYMBOL&#x00A0;-&gt;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;A&#x00A0;&lt;x,&#x00A0;y&gt;&#x00A0;/&#x00A0;ret_value_of_A
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;B&#x00A0;&lt;y,&#x00A0;z&gt;&#x00A0;/&#x00A0;ret_value_of_B
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
</div>
</td></tr></table>
<!--l. 29--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-19-2-"><td  style="text-align:left;" id="TBL-19-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 30--><p class="indent">   </td></tr></table></div><hr class="endfigure">
   <h3 class="sectionHead"><span class="titlemark">7.3   </span> <a 
 id="x20-500007.3"></a>Parsing terminal symbols</h3>
<!--l. 34--><p class="noindent">Each time a terminal symbol is encountered in a rule, the parser compares it to the current token in the
token list. If it is different the parser backtracks.
<!--l. 36--><p class="noindent">
   <h3 class="sectionHead"><span class="titlemark">7.4   </span> <a 
 id="x20-510007.4"></a>Parsing non terminal symbols</h3>
<!--l. 38--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">7.4.1   </span> <a 
 id="x20-520007.4.1"></a>Starting the parser</h4>
<!--l. 40--><p class="noindent">You can start the parser from the axiom or from any other non terminal symbol. When the parser can
not parse the whole token list a <span 
class="cmti-10">tpg.SyntacticError </span>is raised. The value returned by the parser is the
return value of the parsed symbol.
<!--l. 44--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-530007.4.1"></a>From the axiom</h5>
<!--l. 46--><p class="noindent">The axiom is a special non terminal symbol named <span 
class="cmti-10">START</span>. Parsers are callable objects. When an
instance of a parser is called, the <span 
class="cmti-10">START </span>rule is parsed. The first argument of the call is the string to
parse. The other arguments of the call are given to the <span 
class="cmti-10">START </span>symbol.
<!--l. 52--><p class="indent">   This allows to simply write <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">x=calc("1+1")</span></span></span> to parse and compute an expression if <span 
class="cmti-10">calc </span>is an instance
of an expression parser.
<!--l. 54--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-540007.4.1"></a>From another non terminal symbol</h5>
<!--l. 56--><p class="noindent">It&#8217;s also possible to start parsing from any other non terminal symbol. TPG parsers have a method
named <span 
class="cmti-10">parse</span>. The first argument is the name of the symbol to start from. The second argument is the
string to parse. The other arguments are given to the specified symbol.
<!--l. 62--><p class="indent">   For example to start parsing a <span 
class="cmti-10">Term </span>you can write:
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;f=calc.parse('Term',&#x00A0;"2*3")
</div>
   </td></tr></table>
<!--l. 66--><p class="nopar">
<!--l. 68--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">7.4.2   </span> <a 
 id="x20-550007.4.2"></a>In a rule</h4>
<!--l. 70--><p class="noindent">To parse a non terminal symbol in a rule, TPG call the rule corresponding to the symbol.
<!--l. 72--><p class="noindent">
   <h3 class="sectionHead"><span class="titlemark">7.5   </span> <a 
 id="x20-560007.5"></a>Sequences</h3>
<!--l. 74--><p class="noindent">Sequences in grammar rules describe in which order symbols should appear in the input
string. For example the sequence <span 
class="cmti-10">A</span><span 
class="cmti-10">&#x00A0;B </span>recognizes an <span 
class="cmti-10">A </span>followed by a <span 
class="cmti-10">B</span>. Sequences can be
empty.
<!--l. 78--><p class="indent">   For example to say that a <span 
class="cmti-10">sum </span>is a <span 
class="cmti-10">term plus </span>another <span 
class="cmti-10">term </span>you can write:
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;Sum&#x00A0;-&gt;&#x00A0;Term&#x00A0;'+'&#x00A0;Term&#x00A0;;
</div>
   </td></tr></table>
<!--l. 81--><p class="nopar">
<!--l. 83--><p class="noindent">
   <h3 class="sectionHead"><span class="titlemark">7.6   </span> <a 
 id="x20-570007.6"></a>Alternatives</h3>
<!--l. 85--><p class="noindent">Alternatives in grammar rules describe several possible decompositions of a symbol. The infix pipe
operator (<span 
class="cmsy-10">|</span>) is used to separate alternatives. <span 
class="cmmi-10">A</span><span 
class="cmmi-10">&#x00A0; </span><span 
class="cmsy-10">|</span> <span 
class="cmmi-10">&#x00A0;B </span>recognizes either an <span 
class="cmti-10">A </span>or a <span 
class="cmti-10">B</span>. If both <span 
class="cmti-10">A </span>and <span 
class="cmti-10">B </span>can
be matched only the first match is considered. So the order of alternatives is very important. If an
alternative has an empty choice, it must be the last. Empty choices in other positions will be reported as
syntax errors.
<!--l. 93--><p class="indent">   For example to say that an <span 
class="cmti-10">atom </span>is an <span 
class="cmti-10">integer </span>or an <span 
class="cmti-10">expression in paranthesis </span>you can
write:
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;Atom&#x00A0;-&gt;&#x00A0;integer&#x00A0;|&#x00A0;'\('&#x00A0;Expr&#x00A0;'\)'&#x00A0;;
</div>
   </td></tr></table>
<!--l. 97--><p class="nopar">
<!--l. 99--><p class="noindent">
   <h3 class="sectionHead"><span class="titlemark">7.7   </span> <a 
 id="x20-580007.7"></a>Repetitions</h3>
<!--l. 101--><p class="noindent">Repetitions in grammar rules describe how many times an expression should be matched.
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">A?</span> </dt><dd 
class="description">recognizes zero or one <span 
class="cmti-10">A</span>.
     </dd><dt class="description">
<span 
class="cmbx-10">A*</span> </dt><dd 
class="description">recognizes zero or more <span 
class="cmti-10">A</span>.
     </dd><dt class="description">
<span 
class="cmbx-10">A+</span> </dt><dd 
class="description">recognizes one or more <span 
class="cmti-10">A</span>.
     </dd><dt class="description">
<span 
class="cmbx-10">A</span><span 
class="cmbsy-10">{</span><span 
class="cmbx-10">m,n</span><span 
class="cmbsy-10">}</span> </dt><dd 
class="description">recognizes at least m and at most n <span 
class="cmti-10">A</span>.</dd></dl>
<!--l. 110--><p class="indent">   Repetitions are greedy. Repetitions are translated into Python loops. Thus whatever the length of the
repetitions, the Python stack will not overflow.
<!--l. 114--><p class="noindent">
   <h3 class="sectionHead"><span class="titlemark">7.8   </span> <a 
 id="x20-590007.8"></a>Precedence and grouping</h3>
<!--l. 116--><p class="noindent">The figure&#x00A0;<a 
href="#x20-590012">7.2<!--tex4ht:ref: parser:precedence --></a> lists the different structures in increasing precedence order. To override the default
precedence you can group expressions with parenthesis.
<!--l. 119--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-590012"></a>
                                                                                 

                                                                                 
<div class="center" 
>
<!--l. 119--><p class="noindent">
<br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.2: </td><td  
class="content">Precedence in TPG expressions</td></tr></table><!--tex4ht:label?: x20-590012 -->
<div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-20-" ><colgroup id="TBL-20-1g"><col 
id="TBL-20-1"></colgroup><colgroup id="TBL-20-2g"><col 
id="TBL-20-2"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-20-1-1"  
class="td11">Structure                </td><td  style="white-space:nowrap; text-align:left;" id="TBL-20-1-2"  
class="td11">Example     </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-20-2-1"  
class="td11">Alternative             </td><td  style="white-space:nowrap; text-align:left;" id="TBL-20-2-2"  
class="td11"><span 
class="cmmi-10">A</span><span 
class="cmmi-10">&#x00A0; </span><span 
class="cmsy-10">|</span> <span 
class="cmmi-10">&#x00A0;B     </span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-20-3-1"  
class="td11">Sequence                </td><td  style="white-space:nowrap; text-align:left;" id="TBL-20-3-2"  
class="td11"><span 
class="cmmi-10">A</span><span 
class="cmmi-10">&#x00A0;B         </span></td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-20-4-1"  
class="td11">Repetitions             </td><td  style="white-space:nowrap; text-align:left;" id="TBL-20-4-2"  
class="td11"><span 
class="cmmi-10">A</span>?, <span 
class="cmmi-10">A</span><span 
class="cmsy-10">*</span>, <span 
class="cmmi-10">A</span>+ </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-20-5-1"  
class="td11">Symbol and grouping</td><td  style="white-space:nowrap; text-align:left;" id="TBL-20-5-2"  
class="td11"><span 
class="cmmi-10">A </span>and (<span 
class="cmmi-10">&#x00A0;</span><span 
class="cmmi-10">&#x2026;</span><span 
class="cmmi-10">&#x00A0;</span>)</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-20-6-1"  
class="td11">                            </td>
</tr></table></div> </div>
                                                                                 

                                                                                 
<!--l. 135--><p class="indent">   </td></tr></table></div><hr class="endfigure">
   <h3 class="sectionHead"><span class="titlemark">7.9   </span> <a 
 id="x20-600007.9"></a>Actions</h3>
<!--l. 139--><p class="noindent">Grammar rules can contain actions as Python code. Python code is copied verbatim into the generated
code.
<!--l. 142--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">7.9.1   </span> <a 
 id="x20-610007.9.1"></a>Abstract syntax trees</h4>
<!--l. 144--><p class="noindent">An abstract syntax tree (AST) is an abstract representation of the structure of the input. A node of an
AST is a Python object (there is no constraint about its class). AST nodes are completely defined by the
user.
<!--l. 148--><p class="indent">   The figure&#x00A0;<a 
href="#x20-610013">7.3<!--tex4ht:ref: parser:ASTinst --></a> shows a node symbolizing a couple.
<!--l. 150--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-610013"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-21-" ><colgroup id="TBL-21-1g"><col 
id="TBL-21-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-21-1-"><td  style="text-align:left;" id="TBL-21-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.3: </td><td  
class="content">AST example</td></tr></table><!--tex4ht:label?: x20-610013 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;<br />class&#x00A0;Couple:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;def&#x00A0;__init__(self,&#x00A0;a,&#x00A0;b):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;self.a&#x00A0;=&#x00A0;a
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;self.b&#x00A0;=&#x00A0;b
&#x00A0;<br />
&#x00A0;<br />class&#x00A0;Foo(tpg.Parser):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;r"""
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;COUPLE&#x00A0;-&gt;&#x00A0;'('&#x00A0;ITEM/a&#x00A0;','&#x00A0;ITEM/b&#x00A0;')'&#x00A0;$&#x00A0;c&#x00A0;=&#x00A0;Couple(a,b)&#x00A0;$&#x00A0;;
&#x00A0;<br />
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;COUPLE/$Couple(a,b)$&#x00A0;-&gt;&#x00A0;'('&#x00A0;ITEM/a&#x00A0;','&#x00A0;ITEM/b&#x00A0;')'&#x00A0;;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;"""
</div>
</td></tr></table>
<!--l. 165--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-21-2-"><td  style="text-align:left;" id="TBL-21-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 166--><p class="indent">   </td></tr></table></div><hr class="endfigure">
   <h5 class="subsubsectionHead"><a 
 id="x20-620007.9.1"></a>Creating an AST</h5>
<!--l. 170--><p class="noindent">AST are created in Python code delimited either by <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">$...$</span></span></span> or by <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">{{...}}</span></span></span> (see figure&#x00A0;<a 
href="#x20-610007.9.1">7.9.1<!--tex4ht:ref: parser:AST --></a>).
<!--l. 172--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-630007.9.1"></a>Updating an AST</h5>
<!--l. 174--><p class="noindent">When parsing lists for example it is useful to save all the items of the list. In that case one can use a list
and its append method (see figure&#x00A0;<a 
href="#x20-630014">7.4<!--tex4ht:ref: parser:ASTadd --></a>).
<!--l. 177--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-630014"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-22-" ><colgroup id="TBL-22-1g"><col 
id="TBL-22-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-22-1-"><td  style="text-align:left;" id="TBL-22-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.4: </td><td  
class="content">AST update example</td></tr></table><!--tex4ht:label?: x20-630014 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;<br />class&#x00A0;ListParser(tpg.Parser):
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;r"""
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;LIST/l&#x00A0;-&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;'('
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;l&#x00A0;=&#x00A0;List&lt;&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;ITEM/a&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;l.append(a)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(&#x00A0;','&#x00A0;ITEM/a&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;l.append(a)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;)*
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;')'
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;"""
</div>
</td></tr></table>
<!--l. 192--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-22-2-"><td  style="text-align:left;" id="TBL-22-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 193--><p class="indent">   </td></tr></table></div><hr class="endfigure">
   <h4 class="subsectionHead"><span class="titlemark">7.9.2   </span> <a 
 id="x20-640007.9.2"></a>Text extraction</h4>
<!--l. 197--><p class="noindent">TPG can extract a portion of the input string. The idea is to put marks while parsing and then extract
the text between the two marks. This extracts the whole text between the marks, including the tokens
defined as separators.
<!--l. 201--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">7.9.3   </span> <a 
 id="x20-650007.9.3"></a>Object</h4>
<!--l. 203--><p class="noindent">TPG 3 doesn&#8217;t handle Python object as TPG 2. Only identifiers, integers and strings are known. Other
objects must be written in Python code delimited either by <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">$...$</span></span></span> or by <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">{{...}}</span></span></span>.
<!--l. 207--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-660007.9.3"></a>Argument lists and tuples</h5>
<!--l. 209--><p class="noindent">Argument list is a comma separated list of objects. <span 
class="cmti-10">Remember that arguments are enclosed in left and</span>
<span 
class="cmti-10">right angles.</span>
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;&lt;object1,&#x00A0;object2,&#x00A0;object3&gt;
</div>
   </td></tr></table>
<!--l. 214--><p class="nopar">
<!--l. 216--><p class="indent">   Argument lists and tuples have the same syntax except from the possibility to have default
arguments, argument lists and argument dictionnaries as arguments as in Python.
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;RULE&lt;arg1,&#x00A0;arg2=18,&#x00A0;arg3=None,&#x00A0;*other_args,&#x00A0;**keywords&gt;&#x00A0;-&gt;&#x00A0;;
</div>
   </td></tr></table>
<!--l. 221--><p class="nopar">
<!--l. 223--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-670007.9.3"></a>Python code object</h5>
<!--l. 225--><p class="noindent">A Python code object is a piece of Python code in double curly brackets or in dollar signs. Python code
used in an object expression must have only one line.
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;dict([&#x00A0;(x,x**2)&#x00A0;for&#x00A0;x&#x00A0;in&#x00A0;range(100)&#x00A0;])&#x00A0;$&#x00A0;#&#x00A0;Python&#x00A0;embeded&#x00A0;in&#x00A0;TPG
</div>
   </td></tr></table>
<!--l. 230--><p class="nopar">
<!--l. 232--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-680007.9.3"></a>Text extraction</h5>
<!--l. 234--><p class="noindent">Text extraction is done by the <span 
class="cmti-10">extract </span>method. Marks can be put in the input string by the <span 
class="cmti-10">mark </span>method
or the prefix  operator.
                                                                                 

                                                                                 
   <table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;@beginning&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;equivalent&#x00A0;to&#x00A0;$&#x00A0;beginning&#x00A0;=&#x00A0;self.mark()
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;...
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;@end&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;equivalent&#x00A0;to&#x00A0;$&#x00A0;end&#x00A0;=&#x00A0;self.mark()
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;...
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;my_string&#x00A0;=&#x00A0;self.extract(beginning,&#x00A0;end)
</div>
   </td></tr></table>
<!--l. 243--><p class="nopar">
<!--l. 245--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-690007.9.3"></a>Getting the line and row number of a token</h5>
<!--l. 247--><p class="noindent">The <span 
class="cmti-10">line </span>and <span 
class="cmti-10">row </span>methods return the line and row number of the current token. If the first
parameter is a mark (see&#x00A0;<a 
href="#x20-640007.9.2">7.9.2<!--tex4ht:ref: parser:mark --></a>) the method returns the line number of the token following the
mark.
<!--l. 250--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
 id="x20-700007.9.3"></a>Backtracking</h5>
<!--l. 252--><p class="noindent">The user can force the parser to backtrack in rule actions. The module has a <span 
class="cmti-10">WrongToken </span>exception for
that purpose (see figure&#x00A0;<a 
href="#x20-700015">7.5<!--tex4ht:ref: parser:wrongtoken --></a>).
<!--l. 255--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-700015"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-23-" ><colgroup id="TBL-23-1g"><col 
id="TBL-23-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-23-1-"><td  style="text-align:left;" id="TBL-23-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.5: </td><td  
class="content">Backtracking with <span 
class="cmti-10">WrongToken </span>example</td></tr></table><!--tex4ht:label?: x20-700015 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;NATURAL&#x00A0;matches&#x00A0;integers&#x00A0;greater&#x00A0;than&#x00A0;0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;NATURAL/n&#x00A0;-&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;number/n
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;if&#x00A0;n&lt;1:&#x00A0;raise&#x00A0;tpg.WrongToken&#x00A0;$
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
</div>
</td></tr></table>
<!--l. 263--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-23-2-"><td  style="text-align:left;" id="TBL-23-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 264--><p class="indent">   </td></tr></table></div><hr class="endfigure">
<!--l. 266--><p class="indent">   Parsers have another useful method named <span 
class="cmti-10">check </span>(see figure&#x00A0;<a 
href="#x20-700026">7.6<!--tex4ht:ref: parser:check --></a>). This method checks a condition. If
this condition is false then <span 
class="cmti-10">WrongToken </span>if called in order to backtrack.
<!--l. 270--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-700026"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-24-" ><colgroup id="TBL-24-1g"><col 
id="TBL-24-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-24-1-"><td  style="text-align:left;" id="TBL-24-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.6: </td><td  
class="content">Backtracking with the <span 
class="cmti-10">check </span>method example</td></tr></table><!--tex4ht:label?: x20-700026 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;NATURAL&#x00A0;matches&#x00A0;integers&#x00A0;greater&#x00A0;than&#x00A0;0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;NATURAL/n&#x00A0;-&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;number/n
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;self.check(n&gt;=1)&#x00A0;$
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
</div>
</td></tr></table>
<!--l. 278--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-24-2-"><td  style="text-align:left;" id="TBL-24-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 279--><p class="indent">   </td></tr></table></div><hr class="endfigure">
<!--l. 281--><p class="indent">   A shortcut for the <span 
class="cmti-10">check </span>method is the <span 
class="cmti-10">check </span>keyword followed by the condition to check (see
figure&#x00A0;<a 
href="#x20-700037">7.7<!--tex4ht:ref: parser:checkkw --></a>).
<!--l. 283--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-700037"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-25-" ><colgroup id="TBL-25-1g"><col 
id="TBL-25-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-25-1-"><td  style="text-align:left;" id="TBL-25-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.7: </td><td  
class="content">Backtracking with the <span 
class="cmti-10">check </span>keyword example</td></tr></table><!--tex4ht:label?: x20-700037 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;NATURAL&#x00A0;matches&#x00A0;integers&#x00A0;greater&#x00A0;than&#x00A0;0
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;NATURAL/n&#x00A0;-&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;number/n
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;check&#x00A0;$&#x00A0;n&gt;=1&#x00A0;$
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
</div>
</td></tr></table>
<!--l. 291--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-25-2-"><td  style="text-align:left;" id="TBL-25-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 292--><p class="indent">   </td></tr></table></div><hr class="endfigure">
   <h5 class="subsubsectionHead"><a 
 id="x20-710007.9.3"></a>Error reporting</h5>
<!--l. 296--><p class="noindent">The user can force the parser to stop and raise an exception. The parser classes have a <span 
class="cmti-10">error </span>method for
that purpose (see figure&#x00A0;<a 
href="#x20-710018">7.8<!--tex4ht:ref: parser:error_method --></a>). This method raises a <span 
class="cmti-10">SemanticError</span>.
<!--l. 300--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-710018"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-26-" ><colgroup id="TBL-26-1g"><col 
id="TBL-26-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-26-1-"><td  style="text-align:left;" id="TBL-26-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.8: </td><td  
class="content">Error reporting the <span 
class="cmti-10">error </span>method example</td></tr></table><!--tex4ht:label?: x20-710018 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;FRACT&#x00A0;parses&#x00A0;fractions
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;FRACT/&lt;n,d&gt;&#x00A0;-&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;number/n&#x00A0;'/'&#x00A0;number/d
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;$&#x00A0;if&#x00A0;d==0:&#x00A0;self.error("Division&#x00A0;by&#x00A0;zero")&#x00A0;$
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
</div>
</td></tr></table>
<!--l. 308--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-26-2-"><td  style="text-align:left;" id="TBL-26-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 309--><p class="indent">   </td></tr></table></div><hr class="endfigure">
<!--l. 311--><p class="indent">   A shortcut for the <span 
class="cmti-10">error </span>method is the <span 
class="cmti-10">error </span>keyword followed by the object to give to the
<span 
class="cmti-10">SemanticError </span>exception (see figure&#x00A0;<a 
href="#x20-710029">7.9<!--tex4ht:ref: parser:error_kw --></a>).
<!--l. 313--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
 id="x20-710029"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
frame="border" id="TBL-27-" ><colgroup id="TBL-27-1g"><col 
id="TBL-27-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-27-1-"><td  style="text-align:left;" id="TBL-27-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&#x00A0;7.9: </td><td  
class="content">Error reporting the <span 
class="cmti-10">error </span>keyword example</td></tr></table><!--tex4ht:label?: x20-710029 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;#&#x00A0;FRACT&#x00A0;parses&#x00A0;fractions
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;FRACT/&lt;n,d&gt;&#x00A0;-&gt;
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;number/n&#x00A0;'/'&#x00A0;number/d
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;(&#x00A0;check&#x00A0;d&#x00A0;|&#x00A0;error&#x00A0;"Division&#x00A0;by&#x00A0;zero"&#x00A0;)
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;;
</div>
</td></tr></table>
<!--l. 321--><p class="nopar">                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-27-2-"><td  style="text-align:left;" id="TBL-27-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
                                                                                 

                                                                                 
<!--l. 322--><p class="indent">   </td></tr></table></div><hr class="endfigure">
                                                                                 

                                                                                 
   <!--l. 107--><div class="crosslinks"><p class="noindent">[<a 
href="tpgch8.html" >next</a>] [<a 
href="tpgch6.html" >prev</a>] [<a 
href="tpgch6.html#tailtpgch6.html" >prev-tail</a>] [<a 
href="tpgch7.html" >front</a>] [<a 
href="tpgpa2.html#tpgch7.html" >up</a>] </p></div>
<!--l. 107--><p class="indent">   <a 
 id="tailtpgch7.html"></a>     
</body></html> 
