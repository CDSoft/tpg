<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>6 Lexer</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cis.ohio-state.edu/~gurari/TeX4ht/mn.html)"> 
<meta name="originator" content="TeX4ht (http://www.cis.ohio-state.edu/~gurari/TeX4ht/mn.html)"> 
<!-- html,2 --> 
<meta name="src" content="tpg.tex"> 
<meta name="date" content="2004-04-30 11:35:00"> 
<link rel="stylesheet" type="text/css" href="tpg.css"> 
</head><body 
>
   <div class="crosslinks"><p class="noindent">[<a 
href="tpgch7.html" >next</a>] [<a 
href="tpgch5.html" >prev</a>] [<a 
href="tpgch5.html#tailtpgch5.html" >prev-tail</a>] [<a 
href="#tailtpgch6.html">tail</a>] [<a 
href="tpgpa2.html#tpgch6.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&nbsp;6</span><br><a 
  id="x18-370006"></a>Lexer</h2>
   <h3 class="sectionHead"><span class="titlemark">6.1   </span> <a 
  id="x18-380006.1"></a>Regular expression syntax</h3>
<!--l. 3--><p class="noindent">The lexer is based on the <span 
class="cmti-10">re</span><a 
href="tpg19.html" id="tpg19.html" ><sup>1</sup></a>
module. TPG profits from the power of Python regular expressions. This document assumes the reader is
familiar with regular expressions.
<!--l. 7--><p class="indent">   You can use the syntax of regular expressions as expected by the <span 
class="cmti-10">re </span>module except from the grouping
syntax since it is used by TPG to decide which token is recognized.
   <h3 class="sectionHead"><span class="titlemark">6.2   </span> <a 
  id="x18-390006.2"></a>Token definition</h3>
<!--l. 11--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.2.1   </span> <a 
  id="x18-400006.2.1"></a>Predefined tokens</h4>
<!--l. 13--><p class="noindent">Tokens can be explicitely defined by the <span 
class="cmti-10">token </span>and <span 
class="cmti-10">separator </span>keywords.
<!--l. 15--><p class="indent">   A token is defined by:
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">a name</span> </dt><dd 
class="description">which identifies the token. This name is used by the parser.
     </dd><dt class="description">
<span 
class="cmbx-10">a regular expression</span> </dt><dd 
class="description">which describes what to match to recognize the token.
     </dd><dt class="description">
<span 
class="cmbx-10">an action</span> </dt><dd 
class="description">which can translate the matched text into a Python object. It can be a function of
     one argument or a non callable object. It it is not callable, it will be returned for each token
     otherwise it will be applied to the text of the token and the result will be returned. This
     action is optional. By default the token text is returned.</dd></dl>
<!--l. 24--><p class="indent">   Token definitions must end with a <span 
class="cmti-10">; </span>when no action is specified. The dots after the token name are
optional.
<!--l. 26--><p class="indent">   See figure&nbsp; <a 
href="#x18-400011">6.1<!--tex4ht:ref: lexer:tokens --></a> for examples.
<!--l. 28--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x18-400011"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-15-" ><colgroup id="TBL-15-1g"><col 
id="TBL-15-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-15-1-"><td  align="left" id="TBL-15-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.1: </td><td  
class="content">Token definition examples</td></tr></table><!--tex4ht:label?: x18-400011 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reg.&nbsp;exp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;integer:&nbsp;'\d+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int;
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;ident&nbsp;&nbsp;:&nbsp;'[a-zA-Z]\w*'&nbsp;&nbsp;&nbsp;;
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;bool&nbsp;&nbsp;&nbsp;:&nbsp;'True|False'&nbsp;&nbsp;&nbsp;&nbsp;$&nbsp;lambda&nbsp;b:&nbsp;b=='True'
&nbsp;<br />
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;separator&nbsp;spaces&nbsp;&nbsp;:&nbsp;'\s+';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;white&nbsp;spaces
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;separator&nbsp;comments:&nbsp;'#.*';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;comments
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-15-2-"><td  align="left" id="TBL-15-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 39--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 39--><p class="nopar">
<!--l. 41--><p class="indent">   The order of the declaration of the tokens is important. The first token that is matched is returned.
The regular expression has a special treatment. If it describes a keyword, TPG also looks for a word
boundary after the keyword. If you try to match the keywords <span 
class="cmti-10">if  </span>and <span 
class="cmti-10">ifxyz </span>TPG will internally
search <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">if\b</span></span></span> and <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">ifxyz\b</span></span></span>. This way, <span 
class="cmti-10">if  </span>won&#8217;t match <span 
class="cmti-10">ifxyz </span>and won&#8217;t interfere with general
identifiers (<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">\w+</span></span></span> for example). This behaviour can be disabled since the verision 3 of TPG (see&nbsp;
<a 
href="tpgch5.html#x17-290005.3.2">5.3.2<!--tex4ht:ref: grammar:word_boundary_option --></a>).
<!--l. 43--><p class="indent">   There are two kinds of tokens. Tokens defined by the <span 
class="cmti-10">token </span>keyword are parsed by the parser and
tokens defined by the <span 
class="cmti-10">separator </span>keyword are considered as separators (white spaces or comments for
example) and are wiped out by the lexer.
   <h4 class="subsectionHead"><span class="titlemark">6.2.2   </span> <a 
  id="x18-410006.2.2"></a>Inline tokens</h4>
<!--l. 47--><p class="noindent">Tokens can also be defined on the fly. Their definition are then inlined in the grammar rules. This feature
may be useful for keywords or punctuation signs. Inline tokens can not be transformed by an action as
predefined tokens. They always return the token in a string.
<!--l. 52--><p class="indent">   See figure&nbsp; <a 
href="#x18-410012">6.2<!--tex4ht:ref: lexer:inline_tokens --></a> for examples.
<!--l. 54--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x18-410012"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-16-" ><colgroup id="TBL-16-1g"><col 
id="TBL-16-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-16-1-"><td  align="left" id="TBL-16-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.2: </td><td  
class="content">Inline token definition examples</td></tr></table><!--tex4ht:label?: x18-410012 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;IfThenElse&nbsp;-&gt;
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'if'&nbsp;Cond
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'then'&nbsp;Statement
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'else'&nbsp;Statement
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-16-2-"><td  align="left" id="TBL-16-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 63--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 63--><p class="nopar">
<!--l. 65--><p class="indent">   Inline tokens have a higher precedence than predefined tokens to avoid conflicts (an inlined <span 
class="cmti-10">if </span>won&#8217;t
be matched as a predefined <span 
class="cmti-10">identifier</span>).
   <h3 class="sectionHead"><span class="titlemark">6.3   </span> <a 
  id="x18-420006.3"></a>Token matching</h3>
<!--l. 69--><p class="noindent">TPG works in two stages. The lexer first splits the input string into a list of tokens and then the parser
parses this list. The default lexer is lazy in TPG 3. Tokens are generated while parsing. This way TPG 3
need less memory when parsing huge files.
<!--l. 74--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.3.1   </span> <a 
  id="x18-430006.3.1"></a>Splitting the input string</h4>
<!--l. 76--><p class="noindent">The lexer split the input string according to the token definitions (see&nbsp; <a 
href="#x18-390006.2">6.2<!--tex4ht:ref: lexer:token_def --></a>). When the input string can
not be matched a <span 
class="cmti-10">tpg.LexicalError </span>exception is raised.
<!--l. 78--><p class="indent">   The lexer may loop indefinitely if a token can match an empty string since empty strings are
everywhere.
<!--l. 80--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.3.2   </span> <a 
  id="x18-440006.3.2"></a>Matching tokens in grammar rules</h4>
<!--l. 82--><p class="noindent">Tokens are matched as symbols are recognized. Predefined tokens have the same syntax than non
terminal symbols. The token text (or the result of the function associated to the token) can be saved by
the infix <span 
class="cmti-10">/ </span>operator (see figure&nbsp; <a 
href="#x18-440013">6.3<!--tex4ht:ref: lexer:token_ret_val --></a>).
<!--l. 86--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x18-440013"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-17-" ><colgroup id="TBL-17-1g"><col 
id="TBL-17-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-17-1-"><td  align="left" id="TBL-17-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.3: </td><td  
class="content">Token usage examples</td></tr></table><!--tex4ht:label?: x18-440013 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;-&gt;&nbsp;ident/i;
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-17-2-"><td  align="left" id="TBL-17-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 91--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 91--><p class="nopar">
<!--l. 93--><p class="indent">   Inline tokens have a similar syntax. You just write the regular expression (in a string). Its text can
also be save (see figure&nbsp; <a 
href="#x18-440024">6.4<!--tex4ht:ref: lexer:inline_token_ret_val --></a>).
<!--l. 95--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x18-440024"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-18-" ><colgroup id="TBL-18-1g"><col 
id="TBL-18-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-18-1-"><td  align="left" id="TBL-18-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.4: </td><td  
class="content">Token usage examples</td></tr></table><!--tex4ht:label?: x18-440024 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;-&gt;&nbsp;'('&nbsp;'\w+'/i&nbsp;')';
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-18-2-"><td  align="left" id="TBL-18-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 100--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 100--><p class="nopar">
                                                                                 

                                                                                 
   <div class="crosslinks"><p class="noindent">[<a 
href="tpgch7.html" >next</a>] [<a 
href="tpgch5.html" >prev</a>] [<a 
href="tpgch5.html#tailtpgch5.html" >prev-tail</a>] [<a 
href="tpgch6.html" >front</a>] [<a 
href="tpgpa2.html#tpgch6.html" >up</a>] </p></div>
<!--l. 105--><p class="indent">   <a 
  id="tailtpgch6.html"></a>    
</body></html> 
