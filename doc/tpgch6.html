<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>6 Lexer</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cis.ohio-state.edu/~gurari/TeX4ht/mn.html)"> 
<meta name="originator" content="TeX4ht (http://www.cis.ohio-state.edu/~gurari/TeX4ht/mn.html)"> 
<!-- html,2 --> 
<meta name="src" content="tpg.tex"> 
<meta name="date" content="2003-05-19 22:40:00"> 
<link rel="stylesheet" type="text/css" href="tpg.css"> 
</head><body 
>
   <div class="crosslinks"><p class="noindent">[<a 
href="tpgch7.html" >next</a>] [<a 
href="tpgch5.html" >prev</a>] [<a 
href="tpgch5.html#tailtpgch5.html" >prev-tail</a>] [<a 
href="#tailtpgch6.html">tail</a>] [<a 
href="tpgpa2.html#tpgch6.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&nbsp;6</span><br><a 
  id="x19-400006"></a>Lexer</h2>
   <h3 class="sectionHead"><span class="titlemark">6.1   </span> <a 
  id="x19-410006.1"></a>Regular expression syntax</h3>
<!--l. 3--><p class="noindent">The lexer is based on the <span 
class="cmti-10">re</span><a 
href="tpg20.html" id="tpg20.html" ><sup>1</sup></a>
module. TPG profits from the power of Python regular expressions. This document assumes the reader is
familiar with regular expressions.
<!--l. 7--><p class="indent">   You can use the syntax of regular expressions as expected by the <span 
class="cmti-10">re </span>module except from the grouping
syntax since it is used by TPG to decide which token is recognized.
   <h3 class="sectionHead"><span class="titlemark">6.2   </span> <a 
  id="x19-420006.2"></a>Token definition</h3>
<!--l. 11--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.2.1   </span> <a 
  id="x19-430006.2.1"></a>Predefined tokens</h4>
<!--l. 13--><p class="noindent">Tokens can be explicitely defined by the <span 
class="cmti-10">token </span>and <span 
class="cmti-10">separator </span>keywords.
<!--l. 15--><p class="indent">   A token is defined by:
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">a name</span> </dt><dd 
class="description">which identifies the token. This name is used by the parser.
     </dd><dt class="description">
<span 
class="cmbx-10">a regular expression</span> </dt><dd 
class="description">which describes what to match to recognize the token.
     </dd><dt class="description">
<span 
class="cmbx-10">an action</span> </dt><dd 
class="description">which can translate the matched text into a Python object. It can be a function of
     one argument or a non callable object. It it is not callable, it will be returned for each token
     otherwise it will be applied to the text of the token and the result will be returned. This
     action is optional. By default the token text is returned.</dd></dl>
<!--l. 24--><p class="indent">   Token definitions end with a <span 
class="cmti-10">; </span>.
<!--l. 26--><p class="indent">   See figure&nbsp; <a 
href="#x19-430011">6.1<!--tex4ht:ref: lexer:tokens --></a> for examples.
<!--l. 28--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x19-430011"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-16-" ><colgroup id="TBL-16-1g"><col 
id="TBL-16-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-16-1-"><td  align="left" id="TBL-16-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.1: </td><td  
class="content">Token definition examples</td></tr></table><!--tex4ht:label?: x19-430011 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reg.&nbsp;exp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;integer:&nbsp;'\d+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int;
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;ident&nbsp;&nbsp;:&nbsp;'[a-zA-Z]\w*'&nbsp;&nbsp;&nbsp;;
&nbsp;<br />
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;separator&nbsp;spaces&nbsp;&nbsp;:&nbsp;'\s+';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;white&nbsp;spaces
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;separator&nbsp;comments:&nbsp;'#.*';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;comments
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-16-2-"><td  align="left" id="TBL-16-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 38--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 38--><p class="nopar">
<!--l. 40--><p class="indent">   The order of the declaration of the tokens is important. The first token that is matched is returned.
The regular expression has a special treatment. If it describes a keyword, TPG also looks for a word
boundary after the keyword. If you try to match the keywords <span 
class="cmti-10">if </span>and <span 
class="cmti-10">ifxyz </span>TPG will internally search
<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">if\b</span></span></span> and <span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">ifxyz\b</span></span></span>. This way, <span 
class="cmti-10">if </span>won&#8217;t match <span 
class="cmti-10">ifxyz </span>and won&#8217;t interfere with general identifiers (<span class="obeylines-h"><span class="verb"><span 
class="cmtt-10">\w+</span></span></span> for
example).
<!--l. 42--><p class="indent">   There are two kinds of tokens. Tokens defined by the <span 
class="cmti-10">token </span>keyword are parsed by the parser and
tokens defined by the <span 
class="cmti-10">separator </span>keyword are considered as separators (white spaces or comments for
example) and are wiped out by the lexer.
   <h4 class="subsectionHead"><span class="titlemark">6.2.2   </span> <a 
  id="x19-440006.2.2"></a>Inline tokens</h4>
<!--l. 46--><p class="noindent">Tokens can also be defined on the fly. Their definition are then inlined in the grammar rules. This feature
may be useful for keywords or punctuation signs. Inline tokens can not be transformed by an action as
predefined tokens. They always return the token in a string.
<!--l. 51--><p class="indent">   See figure&nbsp; <a 
href="#x19-440012">6.2<!--tex4ht:ref: lexer:inline_tokens --></a> for examples.
<!--l. 53--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x19-440012"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-17-" ><colgroup id="TBL-17-1g"><col 
id="TBL-17-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-17-1-"><td  align="left" id="TBL-17-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.2: </td><td  
class="content">Inline token definition examples</td></tr></table><!--tex4ht:label?: x19-440012 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;IfThenElse&nbsp;-&gt;
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'if'&nbsp;Cond
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'then'&nbsp;Statement
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'else'&nbsp;Statement
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-17-2-"><td  align="left" id="TBL-17-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 62--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 62--><p class="nopar">
<!--l. 64--><p class="indent">   Inline tokens have a higher precedence than predefined tokens to avoid conflicts (an inlined <span 
class="cmti-10">if </span>won&#8217;t
be matched as a predefined <span 
class="cmti-10">identifier</span>).
   <h3 class="sectionHead"><span class="titlemark">6.3   </span> <a 
  id="x19-450006.3"></a>Token matching</h3>
<!--l. 68--><p class="noindent">TPG works in two stages. The lexer first splits the input string into a list of tokens and then the parser
parses this list.
<!--l. 71--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.3.1   </span> <a 
  id="x19-460006.3.1"></a>Splitting the input string</h4>
<!--l. 73--><p class="noindent">The lexer split the input string according to the token definitions (see&nbsp; <a 
href="#x19-420006.2">6.2<!--tex4ht:ref: lexer:token_def --></a>). When the input string can
not be matched a <span 
class="cmti-10">tpg.LexerError </span>exception is raised.
<!--l. 75--><p class="indent">   The lexer may loop indefinitely if a token can match an empty string since empty strings are
everywhere.
<!--l. 77--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.3.2   </span> <a 
  id="x19-470006.3.2"></a>Matching tokens in grammar rules</h4>
<!--l. 79--><p class="noindent">Tokens are matched as symbols are recognized. Predefined tokens have the same syntax than non
terminal symbols. The token text (or the result of the function associated to the token) can be saved by
the infix <span 
class="cmti-10">/ </span>operator (see figure&nbsp; <a 
href="#x19-470013">6.3<!--tex4ht:ref: lexer:token_ret_val --></a>).
<!--l. 83--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x19-470013"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-18-" ><colgroup id="TBL-18-1g"><col 
id="TBL-18-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-18-1-"><td  align="left" id="TBL-18-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.3: </td><td  
class="content">Token usage examples</td></tr></table><!--tex4ht:label?: x19-470013 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;-&gt;&nbsp;ident/i;
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-18-2-"><td  align="left" id="TBL-18-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 88--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 88--><p class="nopar">
<!--l. 90--><p class="indent">   Inline tokens have a similar syntax. You just write the regular expression (in a string). Its text can
also be save (see figure&nbsp; <a 
href="#x19-470024">6.4<!--tex4ht:ref: lexer:inline_token_ret_val --></a>).
<!--l. 92--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x19-470024"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-19-" ><colgroup id="TBL-19-1g"><col 
id="TBL-19-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-19-1-"><td  align="left" id="TBL-19-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.4: </td><td  
class="content">Token usage examples</td></tr></table><!--tex4ht:label?: x19-470024 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;-&gt;&nbsp;'('&nbsp;'\w+'/i&nbsp;')';
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-19-2-"><td  align="left" id="TBL-19-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 97--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 97--><p class="nopar">
   <h3 class="sectionHead"><span class="titlemark">6.4   </span> <a 
  id="x19-480006.4"></a>Special tokens</h3>
<!--l. 101--><p class="noindent">Their are some special tokens that have been requested by some users but these tokens can not be easily
described by TPG using classical token definition (see&nbsp; <a 
href="#x19-420006.2">6.2<!--tex4ht:ref: lexer:token_def --></a>).
<!--l. 104--><p class="noindent">
   <h4 class="subsectionHead"><span class="titlemark">6.4.1   </span> <a 
  id="x19-490006.4.1"></a>Indent and deindent tokens</h4>
<!--l. 106--><p class="noindent">TPG is written in Python so is should be easy to handle INDENT and DEINDENT tokens as in Python
language. These tokens are introduced in the source to be parsed by a preprocessor, before the lexer is
activated. Spaces in the beginning the lines are replaced by indent and deindent tokens when needed.
These special tokens are characters which ASCII codes are 16 and 17. These characters may not be used
in regular text files.
<!--l. 112--><p class="noindent">
   <h5 class="subsubsectionHead"><a 
  id="x19-500006.4.1"></a>Indent definition</h5>
<!--l. 114--><p class="noindent">The <span 
class="cmti-10">indent </span>option (see&nbsp; <a 
href="tpgch5.html#x18-270005.3">5.3<!--tex4ht:ref: grammar:options --></a>) has been added to define the indentation. It has two values. The first one is
a regular expression describing the indentation, usually spaces and tabulations. The second one is a
regular expression describing the lines not to be taken into account, usually comments. This
second parameter describes the beginning of the line, i.e. <span 
class="cmti-10">&#8221;#&#8221; </span>will match lines starting with a
<span 
class="cmti-10">#</span>.
<!--l. 121--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x19-500015"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-20-" ><colgroup id="TBL-20-1g"><col 
id="TBL-20-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-1-"><td  align="left" id="TBL-20-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.5: </td><td  
class="content">Indent and deindent definition example</td></tr></table><!--tex4ht:label?: x19-500015 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;indent&nbsp;=&nbsp;&#34;\s&#34;,&nbsp;&#34;#&#34;
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-20-2-"><td  align="left" id="TBL-20-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 126--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 126--><p class="nopar">
   <h5 class="subsubsectionHead"><a 
  id="x19-510006.4.1"></a>Indent and deindent usage</h5>
<!--l. 130--><p class="noindent">When the <span 
class="cmti-10">indent </span>option is active, <span 
class="cmti-10">indent </span>and <span 
class="cmti-10">deindent </span>tokens are defined. They can be used as any other
token.
<!--l. 133--><p class="indent">   <hr class="figure"><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                 

                                                                                 
<a 
  id="x19-510016"></a>
                                                                                 

                                                                                 
   <div class="tabular"><table class="tabular" 
cellspacing="0pt" cellpadding="0" rules="groups" 
frame="border" id="TBL-21-" ><colgroup id="TBL-21-1g"><col 
id="TBL-21-1"></colgroup><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-21-1-"><td  align="left" id="TBL-21-1-1"  
class="td11"><br> <table class="caption" 
><tr valign="baseline" class="caption"><td class="id">Figure&nbsp;6.6: </td><td  
class="content">Indent and deindent example</td></tr></table><!--tex4ht:label?: x19-510016 -->
<table width="100%" 
class="verbatim"><tr class="verbatim"><td 
class="verbatim"><div class="verbatim">
parser&nbsp;IndentParser:
&nbsp;<br />
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;indent&nbsp;=&nbsp;&#34;\s&#34;,&nbsp;&#34;#&#34;
&nbsp;<br />
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;BLOCK&nbsp;-&gt;
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;INSTR
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;indent
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BLOCK
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deindent
&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)*;
</div>
</td></tr></table>                                                                                 </td>
</tr><tr 
class="hline"><td><hr></td></tr><tr  
 valign="baseline" id="TBL-21-2-"><td  align="left" id="TBL-21-2-1"  
class="td11">                                                                                                                               </td> </tr></table>
</div>
<!--l. 147--><p class="nopar">
                                                                                 

                                                                                 
   </td></tr></table></div><hr class="endfigure">
<!--l. 147--><p class="nopar">
                                                                                 

                                                                                 
   <div class="crosslinks"><p class="noindent">[<a 
href="tpgch7.html" >next</a>] [<a 
href="tpgch5.html" >prev</a>] [<a 
href="tpgch5.html#tailtpgch5.html" >prev-tail</a>] [<a 
href="tpgch6.html" >front</a>] [<a 
href="tpgpa2.html#tpgch6.html" >up</a>] </p></div>
<!--l. 105--><p class="indent">   <a 
  id="tailtpgch6.html"></a>     
</body></html> 
